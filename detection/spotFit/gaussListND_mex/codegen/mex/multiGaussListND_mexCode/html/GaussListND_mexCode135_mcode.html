<pre class="code">
<span class="srcline"><span class="lineno"><a href="50,1" id="srcline1"> 1</a></span><span class="line"><span class="keyword">function</span> <span class="var type1" id="S2T25U3">gaussList</span> = GaussListND_mexCode(<span class="var type1" id="S3T1U6">coordList</span>,<span class="var type1" id="S4T4U7">sigma</span>,<span class="var type1" id="S5T4U8">center</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="50,2" id="srcline2"> 2</a></span><span class="line"><span class="comment">%GAUSSLISTND calculates the value of a N-D Gaussian at specific pixel/voxel coordinates</span></span></span>
<span class="srcline"><span class="lineno"><a href="50,3" id="srcline3"> 3</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="50,4" id="srcline4"> 4</a></span><span class="line"><span class="comment">% SYNOPSIS gaussList = GaussListND(coordList,sigma,center,intNorm,rotation)</span></span></span>
<span class="srcline"><span class="lineno"><a href="50,5" id="srcline5"> 5</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="50,6" id="srcline6"> 6</a></span><span class="line"><span class="comment">% INPUT    coordList : m-by-n list of coordinates, where m is the number of</span></span></span>
<span class="srcline"><span class="lineno"><a href="50,7" id="srcline7"> 7</a></span><span class="line"><span class="comment">%                      coordinates and n the number of dimensions</span></span></span>
<span class="srcline"><span class="lineno"><a href="50,8" id="srcline8"> 8</a></span><span class="line"><span class="comment">%          sigma     : 1-by-n (or scalar): sigma of Gaussian</span></span></span>
<span class="srcline"><span class="lineno"><a href="50,9" id="srcline9"> 9</a></span><span class="line"><span class="comment">%          center    : (opt) 1-by-n vector of center of Gaussian.</span></span></span>
<span class="srcline"><span class="lineno"><a href="50,10" id="srcline10">10</a></span><span class="line"><span class="comment">%                      Default: zeros(1,n)</span></span></span>
<span class="srcline"><span class="lineno"><a href="50,11" id="srcline11">11</a></span><span class="line"><span class="comment">%          intNorm   : (opt) switch for how the Gaussian should be normed</span></span></span>
<span class="srcline"><span class="lineno"><a href="50,12" id="srcline12">12</a></span><span class="line"><span class="comment">%                      Default: 0</span></span></span>
<span class="srcline"><span class="lineno"><a href="50,13" id="srcline13">13</a></span><span class="line"><span class="comment">%                      0 - no norming. Max of Gaussian == 1</span></span></span>
<span class="srcline"><span class="lineno"><a href="50,14" id="srcline14">14</a></span><span class="line"><span class="comment">%                      1 - normed so that integral of infinite Gaussian = 1</span></span></span>
<span class="srcline"><span class="lineno"><a href="50,15" id="srcline15">15</a></span><span class="line"><span class="comment">%          rotation  : (opt) Equal to the number of degree you want the</span></span></span>
<span class="srcline"><span class="lineno"><a href="50,16" id="srcline16">16</a></span><span class="line"><span class="comment">%                            coordinate to be rotate for. If rotation is</span></span></span>
<span class="srcline"><span class="lineno"><a href="50,17" id="srcline17">17</a></span><span class="line"><span class="comment">%                            equal to 1, rotation will be random.</span></span></span>
<span class="srcline"><span class="lineno"><a href="50,18" id="srcline18">18</a></span><span class="line"><span class="comment">%                            Default: 0;</span></span></span>
<span class="srcline"><span class="lineno"><a href="50,19" id="srcline19">19</a></span><span class="line"><span class="comment">%                            Rotation is only supported for 2D and 3D case</span></span></span>
<span class="srcline"><span class="lineno"><a href="50,20" id="srcline20">20</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="50,21" id="srcline21">21</a></span><span class="line"><span class="comment">% OUTPUT   gaussList : m-by-1 list of intensities. Intensity is the</span></span></span>
<span class="srcline"><span class="lineno"><a href="50,22" id="srcline22">22</a></span><span class="line"><span class="comment">%                      integral of the Gaussian over the pixel/voxel</span></span></span>
<span class="srcline"><span class="lineno"><a href="50,23" id="srcline23">23</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="50,24" id="srcline24">24</a></span><span class="line"><span class="comment">% REMARKS  The code assumes that a pixel has the edge length 1!</span></span></span>
<span class="srcline"><span class="lineno"><a href="50,25" id="srcline25">25</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="50,26" id="srcline26">26</a></span><span class="line"><span class="comment">% c: 2/05 jonas</span></span></span>
<span class="srcline"><span class="lineno"><a href="50,27" id="srcline27">27</a></span><span class="line"><span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span></span></span>
<span class="srcline"><span class="lineno"><a href="50,28" id="srcline28">28</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="50,29" id="srcline29">29</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="50,30" id="srcline30">30</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="50,31" id="srcline31">31</a></span><span class="line"><span class="mxinfo" id="T3:U5">[<span class="var type1" id="S6T3U12">nCoords</span>,<span class="var type1" id="S7T3U13">nDims</span>] = size(<span class="var type1" id="S3T1U16">coordList</span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="50,32" id="srcline32">32</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="50,33" id="srcline33">33</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="50,34" id="srcline34">34</a></span><span class="line"><span class="mxinfo" id="T1:U9"><span class="var type1" id="S9T1U19">sigma2</span> = <span class="mxinfo" id="T1:U11">repmat(<span class="var type1" id="S4T4U22">sigma</span>,<span class="mxinfo" id="T7:U13">[<span class="var type1" id="S6T3U25">nCoords</span>,<span class="mxinfo" id="T3:U15">1</span>]</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="50,35" id="srcline35">35</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="50,36" id="srcline36">36</a></span><span class="line"><span class="mxinfo" id="T1:U16"><span class="var type1" id="S11T1U29">center2</span> = <span class="mxinfo" id="T1:U18">repmat(<span class="var type1" id="S5T4U32">center</span>, <span class="mxinfo" id="T7:U20">[<span class="var type1" id="S6T3U35">nCoords</span>,<span class="mxinfo" id="T3:U22">1</span>]</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="50,37" id="srcline37">37</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="50,38" id="srcline38">38</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="50,39" id="srcline39">39</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="50,40" id="srcline40">40</a></span><span class="line"><span class="comment">%======================</span></span></span>
<span class="srcline"><span class="lineno"><a href="50,41" id="srcline41">41</a></span><span class="line"><span class="comment">% CALC GAUSSLIST</span></span></span>
<span class="srcline"><span class="lineno"><a href="50,42" id="srcline42">42</a></span><span class="line"><span class="comment">%======================</span></span></span>
<span class="srcline"><span class="lineno"><a href="50,43" id="srcline43">43</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="50,44" id="srcline44">44</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="50,45" id="srcline45">45</a></span><span class="line"><span class="comment">% instead of calculating Gauss-values for very complicated geometries, we</span></span></span>
<span class="srcline"><span class="lineno"><a href="50,46" id="srcline46">46</a></span><span class="line"><span class="comment">% make a coordinate transformation so that we can use sigma=1 in all</span></span></span>
<span class="srcline"><span class="lineno"><a href="50,47" id="srcline47">47</a></span><span class="line"><span class="comment">% dimensions</span></span></span>
<span class="srcline"><span class="lineno"><a href="50,48" id="srcline48">48</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="50,49" id="srcline49">49</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="50,50" id="srcline50">50</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="50,51" id="srcline51">51</a></span><span class="line"><span class="comment">% 0.5*erfc(-(x+0.5)/sqrt(2))-0.5*erfc(-(x-0.5)/sqrt(2)) gives the integral on the</span></span></span>
<span class="srcline"><span class="lineno"><a href="50,52" id="srcline52">52</a></span><span class="line"><span class="comment">% pixel at 1 of a Gaussian with mean 0 and sigma 1</span></span></span>
<span class="srcline"><span class="lineno"><a href="50,53" id="srcline53">53</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="50,54" id="srcline54">54</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="50,55" id="srcline55">55</a></span><span class="line"><span class="comment">%center3 = center2(:,1);</span></span></span>
<span class="srcline"><span class="lineno"><a href="50,56" id="srcline56">56</a></span><span class="line"><span class="comment">%clear center2</span></span></span>
<span class="srcline"><span class="lineno"><a href="50,57" id="srcline57">57</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="50,58" id="srcline58">58</a></span><span class="line"><span class="comment">% convert coordList to 0/1</span></span></span>
<span class="srcline"><span class="lineno"><a href="50,59" id="srcline59">59</a></span><span class="line"><span class="mxinfo" id="T1:U23"><span class="var type1" id="S12T1U39">coordList2</span> = <span class="mxinfo" id="T1:U25">(<span class="mxinfo" id="T1:U26"><span class="mxinfo" id="T1:U27"><span class="var type1" id="S3T1U44">coordList</span>(<span class="mxinfo" id="T9:U29"><span class="mxinfo" id="T3:U30">1</span>:<span class="var type1" id="S6T3U47">nCoords</span></span>,<span class="mxinfo" id="T9:U32"><span class="mxinfo" id="T3:U33">1</span>:<span class="var type1" id="S7T3U50">nDims</span></span>)</span> - <span class="mxinfo" id="T1:U35"><span class="var type1" id="S11T1U52">center2</span>(<span class="mxinfo" id="T9:U37"><span class="mxinfo" id="T3:U38">1</span>:<span class="var type1" id="S6T3U55">nCoords</span></span>,<span class="mxinfo" id="T9:U40"><span class="mxinfo" id="T3:U41">1</span>:<span class="var type1" id="S7T3U58">nDims</span></span>)</span></span>)./<span class="mxinfo" id="T1:U43"><span class="var type1" id="S9T1U60">sigma2</span>(<span class="mxinfo" id="T9:U45"><span class="mxinfo" id="T3:U46">1</span>:<span class="var type1" id="S6T3U63">nCoords</span></span>,<span class="mxinfo" id="T9:U48"><span class="mxinfo" id="T3:U49">1</span>:<span class="var type1" id="S7T3U66">nDims</span></span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="50,60" id="srcline60">60</a></span><span class="line"><span class="comment">%clear coordList center3</span></span></span>
<span class="srcline"><span class="lineno"><a href="50,61" id="srcline61">61</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="50,62" id="srcline62">62</a></span><span class="line"><span class="comment">% double coordList as preparation for erfc</span></span></span>
<span class="srcline"><span class="lineno"><a href="50,63" id="srcline63">63</a></span><span class="line"><span class="comment">%fixed bug: must divide the 0.5 by sigma - KJ</span></span></span>
<span class="srcline"><span class="lineno"><a href="50,64" id="srcline64">64</a></span><span class="line"><span class="mxinfo" id="T26:U51"><span class="var type1" id="S12T26U69">coordList2</span> = <span class="mxinfo" id="T26:U53">cat(3,<span class="mxinfo" id="T1:U54"><span class="var type1" id="S12T1U74">coordList2</span>-<span class="mxinfo" id="T1:U56"><span class="mxinfo" id="T3:U57">0.5</span>./<span class="mxinfo" id="T1:U58"><span class="var type1" id="S9T1U78">sigma2</span>(<span class="mxinfo" id="T9:U60"><span class="mxinfo" id="T3:U61">1</span>:<span class="var type1" id="S6T3U81">nCoords</span></span>,<span class="mxinfo" id="T9:U63"><span class="mxinfo" id="T3:U64">1</span>:<span class="var type1" id="S7T3U84">nDims</span></span>)</span></span></span>, <span class="mxinfo" id="T1:U66"><span class="var type1" id="S12T1U86">coordList2</span>+<span class="mxinfo" id="T1:U68"><span class="mxinfo" id="T3:U69">0.5</span>./<span class="mxinfo" id="T1:U70"><span class="var type1" id="S9T1U90">sigma2</span>(<span class="mxinfo" id="T9:U72"><span class="mxinfo" id="T3:U73">1</span>:<span class="var type1" id="S6T3U93">nCoords</span></span>,<span class="mxinfo" id="T9:U75"><span class="mxinfo" id="T3:U76">1</span>:<span class="var type1" id="S7T3U96">nDims</span></span>)</span></span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="50,65" id="srcline65">65</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="50,66" id="srcline66">66</a></span><span class="line"><span class="comment">% calculate gaussList</span></span></span>
<span class="srcline"><span class="lineno"><a href="50,67" id="srcline67">67</a></span><span class="line"><span class="comment">%Jonas was missing the minus sign in erfc. I corrected that - KJ</span></span></span>
<span class="srcline"><span class="lineno"><a href="50,68" id="srcline68">68</a></span><span class="line"><span class="mxinfo" id="T20:U78"><span class="var type1" id="S2T20U99">gaussList</span> = <span class="mxinfo" id="T20:U80">diff(<span class="mxinfo" id="T26:U81"><span class="mxinfo" id="T3:U82">0.5</span> * <span class="mxinfo" id="T26:U83">erfc(<span class="mxinfo" id="T26:U84"><span class="mxinfo" id="T26:U85">-<span class="var type1" id="S12T26U108">coordList2</span></span>/<span class="mxinfo" id="T3:U87">sqrt(2)</span></span>)</span></span>,1,3)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="50,69" id="srcline69">69</a></span><span class="line"><span class="mxinfo" id="T25:U88"><span class="var type1" id="S2T25U116">gaussList</span> = <span class="mxinfo" id="T25:U90">prod(<span class="var type1" id="S2T20U119">gaussList</span>,2)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="50,70" id="srcline70">70</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="50,71" id="srcline71">71</a></span><span class="line"><span class="comment">% norm gaussList</span></span></span>
<span class="srcline"><span class="lineno"><a href="50,72" id="srcline72">72</a></span><span class="line"><span class="mxinfo" id="T25:U92"><span class="var type1" id="S2T25U123">gaussList</span> = <span class="mxinfo" id="T25:U94"><span class="var type1" id="S2T25U125">gaussList</span>*(<span class="mxinfo" id="T3:U96"><span class="mxinfo" id="T3:U97">(<span class="mxinfo" id="T3:U98">2*pi</span>)^(<span class="mxinfo" id="T3:U99"><span class="mxinfo" id="T3:U100">0.5</span>*<span class="var type1" id="S7T3U137">nDims</span></span>)</span>*<span class="mxinfo" id="T3:U102">prod(<span class="mxinfo" id="T4:U103"><span class="var type1" id="S9T1U141">sigma2</span>(<span class="mxinfo" id="T3:U105">1</span>,:)</span>)</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="50,73" id="srcline73">73</a></span><span class="line"></span></span>
</pre>
