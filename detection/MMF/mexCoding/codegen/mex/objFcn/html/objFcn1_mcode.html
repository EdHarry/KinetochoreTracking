<pre class="code">
<span class="srcline"><span class="lineno"><a href="1,1">  1</a></span><span class="line"><span class="keyword">function</span> [<span class="var type1" id="S2T5U3">mode</span>, <span class="var type1" id="S3T4U4">f</span>, <span class="var type1" id="S4T4U5">fjac</span>, <span class="var type1" id="S5T1U6">user</span>] = objFcn(<span class="mxinfo" id="T5:U5"><span class="mxinfo" id="T5:U6"><span class="var type1" id="S2T5U9">mode</span></span></span>, <span class="var type1" id="S6T5U10">m</span>, <span class="var type1" id="S7T5U11">n</span>, <span class="var type1" id="S8T5U12">ldfj</span>, <span class="var type1" id="S9T5U13">needfi</span>, <span class="var type1" id="S10T6U14">x</span>, <span class="mxinfo" id="T4:U13"><span class="mxinfo" id="T4:U14"><span class="var type1" id="S4T4U15">fjac</span></span></span>, <span class="var type1" id="S11T5U16">nstate</span>, <span class="mxinfo" id="T1:U17"><span class="mxinfo" id="T1:U18"><span class="var type1" id="S5T1U17">user</span></span></span>)<span class="comment">%#codegen</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,2">  2</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,3">  3</a></span><span class="line"><span class="comment">% defaults</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,4">  4</a></span><span class="line"><span class="mxinfo" id="T4:U20"><span class="var type1" id="S3T4U20">f</span> = <span class="mxinfo" id="T27:U22">[]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,5">  5</a></span><span class="line"><span class="mxinfo" id="T4:U23"><span class="var type1" id="S4T4U25">fjac</span> = <span class="mxinfo" id="T27:U25">[]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,6">  6</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,7">  7</a></span><span class="line"><span class="comment">%% core</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,8">  8</a></span><span class="line"><span class="comment">%extract background intensity from x0 and remove from vector</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,9">  9</a></span><span class="line"><span class="mxinfo" id="T7:U26"><span class="var type1" id="S12T7U30">bgAmp</span> = <span class="mxinfo" id="T7:U28"><span class="var type1" id="S10T6U32">x</span>(<span class="mxinfo" id="T7:U30">end</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,10"> 10</a></span><span class="line"><span class="mxinfo" id="T6:U31"><span class="var type1" id="S10T6U37">x</span> = <span class="mxinfo" id="T6:U33"><span class="var type1" id="S10T6U39">x</span>(<span class="mxinfo" id="T30:U35"><span class="mxinfo" id="T7:U36">1</span>:<span class="mxinfo" id="T7:U37"><span class="mxinfo" id="T7:U38">end</span>-<span class="mxinfo" id="T7:U39">1</span></span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,11"> 11</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,12"> 12</a></span><span class="line"><span class="comment">%reshape 4nx1 vector x0 into nx4 matrix</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,13"> 13</a></span><span class="line"><span class="mxinfo" id="T5:U40"><span class="var type1" id="S7T5U48">n</span> = <span class="mxinfo" id="T5:U42">(<span class="mxinfo" id="T5:U43"><span class="var type1" id="S7T5U52">n</span>-<span class="mxinfo" id="T5:U45">1</span></span>)/<span class="mxinfo" id="T7:U46">4</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,14"> 14</a></span><span class="line"><span class="mxinfo" id="T15:U47"><span class="var type1" id="S10T15U57">x</span> = <span class="mxinfo" id="T15:U49">reshape(<span class="var type1" id="S10T6U60">x</span>,4,<span class="var type1" id="S7T5U62">n</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,15"> 15</a></span><span class="line"><span class="mxinfo" id="T16:U52"><span class="var type1" id="S10T16U65">x</span> = <span class="mxinfo" id="T16:U54"><span class="var type1" id="S10T15U67">x</span>'</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,16"> 16</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,17"> 17</a></span><span class="line"><span class="comment">%extract PSF center positions and amplitudes</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,18"> 18</a></span><span class="line"><span class="mxinfo" id="T2:U56"><span class="var type1" id="S15T2U70">psfPos</span> = <span class="mxinfo" id="T2:U58"><span class="var type1" id="S10T16U72">x</span>(<span class="mxinfo" id="T30:U60">:</span>,<span class="mxinfo" id="T31:U61"><span class="mxinfo" id="T7:U62">1</span>:<span class="mxinfo" id="T7:U63">3</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,19"> 19</a></span><span class="line"><span class="mxinfo" id="T6:U64"><span class="var type1" id="S16T6U79">psfAmp</span> = <span class="mxinfo" id="T6:U66"><span class="var type1" id="S10T16U81">x</span>(<span class="mxinfo" id="T30:U68">:</span>,<span class="mxinfo" id="T7:U69">4</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,20"> 20</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,21"> 21</a></span><span class="line"><span class="comment">%% index mod</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,22"> 22</a></span><span class="line"><span class="mxinfo" id="T2:U70"><span class="var type1" id="S17T2U86">index</span> = <span class="mxinfo" id="T2:U72"><span class="var type1" id="S5T1U88">user</span>.index</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,23"> 23</a></span><span class="line"><span class="mxinfo" id="T3:U74"><span class="var type1" id="S18T3U92">psfSigma</span> = <span class="mxinfo" id="T3:U76"><span class="var type1" id="S5T1U94">user</span>.psfSigma</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,24"> 24</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,25"> 25</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo" id="T9:U78"><span class="var type1" id="S9T5U99">needfi</span> &gt; <span class="mxinfo" id="T7:U80">0</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,26"> 26</a></span><span class="line">    <span class="mxinfo" id="T2:U81"><span class="var type1" id="S17T2U103">index</span> = <span class="mxinfo" id="T20:U83"><span class="var type1" id="S17T2U105">index</span>(<span class="var type1" id="S9T5U106">needfi</span>,<span class="mxinfo" id="T25:U86">:</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,27"> 27</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,28"> 28</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,29"> 29</a></span><span class="line"><span class="comment">%% pixel integration calculations</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,30"> 30</a></span><span class="line"><span class="comment">%find minimum and maximum pixel indices</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,31"> 31</a></span><span class="line"><span class="mxinfo" id="T7:U87"><span class="var type1" id="S19T7U110">minIndxX</span> = <span class="mxinfo" id="T7:U89">min(<span class="mxinfo" id="T6:U90"><span class="var type1" id="S17T2U114">index</span>(<span class="mxinfo" id="T30:U92">:</span>,<span class="mxinfo" id="T7:U93">1</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,32"> 32</a></span><span class="line"><span class="mxinfo" id="T7:U94"><span class="var type1" id="S21T7U119">maxIndxX</span> = <span class="mxinfo" id="T7:U96">max(<span class="mxinfo" id="T6:U97"><span class="var type1" id="S17T2U123">index</span>(<span class="mxinfo" id="T30:U99">:</span>,<span class="mxinfo" id="T7:U100">1</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,33"> 33</a></span><span class="line"><span class="mxinfo" id="T7:U101"><span class="var type1" id="S23T7U128">minIndxY</span> = <span class="mxinfo" id="T7:U103">min(<span class="mxinfo" id="T6:U104"><span class="var type1" id="S17T2U132">index</span>(<span class="mxinfo" id="T30:U106">:</span>,<span class="mxinfo" id="T7:U107">2</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,34"> 34</a></span><span class="line"><span class="mxinfo" id="T7:U108"><span class="var type1" id="S24T7U137">maxIndxY</span> = <span class="mxinfo" id="T7:U110">max(<span class="mxinfo" id="T6:U111"><span class="var type1" id="S17T2U141">index</span>(<span class="mxinfo" id="T30:U113">:</span>,<span class="mxinfo" id="T7:U114">2</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,35"> 35</a></span><span class="line"><span class="mxinfo" id="T7:U115"><span class="var type1" id="S25T7U146">minIndxZ</span> = <span class="mxinfo" id="T7:U117">min(<span class="mxinfo" id="T6:U118"><span class="var type1" id="S17T2U150">index</span>(<span class="mxinfo" id="T30:U120">:</span>,<span class="mxinfo" id="T7:U121">3</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,36"> 36</a></span><span class="line"><span class="mxinfo" id="T7:U122"><span class="var type1" id="S26T7U155">maxIndxZ</span> = <span class="mxinfo" id="T7:U124">max(<span class="mxinfo" id="T6:U125"><span class="var type1" id="S17T2U159">index</span>(<span class="mxinfo" id="T30:U127">:</span>,<span class="mxinfo" id="T7:U128">3</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,37"> 37</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,38"> 38</a></span><span class="line"><span class="comment">% get xy-indices relative to minimum</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,39"> 39</a></span><span class="line"><span class="comment">% relIndxX = index(:,1) - minIndxX + 1;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,40"> 40</a></span><span class="line"><span class="comment">% relIndxY = index(:,2) - minIndxY + 1;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,41"> 41</a></span><span class="line"><span class="comment">% get xy-indices relative to minimum</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,42"> 42</a></span><span class="line"><span class="mxinfo" id="T6:U129"><span class="var type1" id="S27T6U164">relIndxX</span> = <span class="mxinfo" id="T6:U131"><span class="mxinfo" id="T6:U132"><span class="mxinfo" id="T6:U133"><span class="var type1" id="S17T2U168">index</span>(<span class="mxinfo" id="T30:U135">:</span>,<span class="mxinfo" id="T7:U136">1</span>)</span> - <span class="var type1" id="S19T7U171">minIndxX</span></span> + <span class="mxinfo" id="T7:U138">1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,43"> 43</a></span><span class="line"><span class="mxinfo" id="T6:U139"><span class="var type1" id="S28T6U175">relIndxY</span> = <span class="mxinfo" id="T6:U141"><span class="mxinfo" id="T6:U142"><span class="mxinfo" id="T6:U143"><span class="var type1" id="S17T2U179">index</span>(<span class="mxinfo" id="T30:U145">:</span>,<span class="mxinfo" id="T7:U146">2</span>)</span> - <span class="var type1" id="S23T7U182">minIndxY</span></span> + <span class="mxinfo" id="T7:U148">1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,44"> 44</a></span><span class="line"><span class="mxinfo" id="T6:U149"><span class="var type1" id="S29T6U186">relIndxZ</span> = <span class="mxinfo" id="T6:U151"><span class="mxinfo" id="T6:U152"><span class="mxinfo" id="T6:U153"><span class="var type1" id="S17T2U190">index</span>(<span class="mxinfo" id="T30:U155">:</span>,<span class="mxinfo" id="T7:U156">3</span>)</span> - <span class="var type1" id="S25T7U193">minIndxZ</span></span> + <span class="mxinfo" id="T7:U158">1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,45"> 45</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,46"> 46</a></span><span class="line"><span class="comment">%determine the contribution of each PSF (assuming amplitude 1) to a</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,47"> 47</a></span><span class="line"><span class="comment">%pixel based on its x-coordinate (needed to calculate F &amp; J)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,48"> 48</a></span><span class="line"><span class="mxinfo" id="T4:U159"><span class="var type1" id="S30T4U197">psfIntegX</span> = <span class="mxinfo" id="T4:U161">zeros(<span class="mxinfo" id="T7:U162"><span class="mxinfo" id="T7:U163"><span class="var type1" id="S21T7U202">maxIndxX</span>-<span class="var type1" id="S19T7U203">minIndxX</span></span>+<span class="mxinfo" id="T7:U166">1</span></span>,<span class="var type1" id="S7T5U205">n</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,49"> 49</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S32T5U208">i</span>=<span class="mxinfo" id="T5:U169">1</span>:<span class="var type1" id="S7T5U211">n</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,50"> 50</a></span><span class="line">    <span class="mxinfo" id="T26:U171"><span class="var type1" id="S33T26U214">temp</span> = <span class="mxinfo" id="T26:U173"><span class="fcn" id="F174N2:B216">GaussListND_mexCode</span>(<span class="mxinfo" id="T6:U174">(<span class="mxinfo" id="T19:U175"><span class="var type1" id="S19T7U220">minIndxX</span>:<span class="var type1" id="S21T7U221">maxIndxX</span></span>)'</span>,<span class="keyword">...</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,51"> 51</a></span><span class="line"><span class="mxinfo" id="T26:U171"><span class="mxinfo" id="T26:U173">        <span class="mxinfo" id="T7:U178"><span class="var type1" id="S18T3U223">psfSigma</span>(<span class="mxinfo" id="T7:U180">1</span>)</span>,<span class="mxinfo" id="T7:U181"><span class="var type1" id="S15T2U226">psfPos</span>(<span class="var type1" id="S32T5U227">i</span>,<span class="mxinfo" id="T7:U184">1</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,52"> 52</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,53"> 53</a></span><span class="line">    <span class="mxinfo" id="T4:U185"><span class="var type1" id="S35T4U231">temp2</span> = <span class="mxinfo" id="T4:U187">squeeze(<span class="var type1" id="S33T26U234">temp</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,54"> 54</a></span><span class="line">    <span class="comment">%clear temp</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,55"> 55</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,56"> 56</a></span><span class="line">    <span class="mxinfo" id="T6:U189"><span class="mxinfo" id="T6:U190"><span class="var type1" id="S30T4U238">psfIntegX</span>(<span class="mxinfo" id="T30:U192">:</span>,<span class="var type1" id="S32T5U240">i</span>)</span> = <span class="mxinfo" id="T6:U194"><span class="var type1" id="S35T4U242">temp2</span>(<span class="mxinfo" id="T30:U196">:</span>,<span class="mxinfo" id="T7:U197">1</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,57"> 57</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,58"> 58</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,59"> 59</a></span><span class="line"><span class="comment">%determine the contribution of each PSF (assuming amplitude 1) to a</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,60"> 60</a></span><span class="line"><span class="comment">%pixel based on its y-coordinate (needed to calculate F &amp; J)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,61"> 61</a></span><span class="line"><span class="mxinfo" id="T4:U198"><span class="var type1" id="S37T4U247">psfIntegY</span> = <span class="mxinfo" id="T4:U200">zeros(<span class="mxinfo" id="T7:U201"><span class="mxinfo" id="T7:U202"><span class="var type1" id="S24T7U252">maxIndxY</span>-<span class="var type1" id="S23T7U253">minIndxY</span></span>+<span class="mxinfo" id="T7:U205">1</span></span>,<span class="var type1" id="S7T5U255">n</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,62"> 62</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S32T5U258">i</span>=<span class="mxinfo" id="T5:U208">1</span>:<span class="var type1" id="S7T5U261">n</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,63"> 63</a></span><span class="line">    <span class="mxinfo" id="T26:U210"><span class="var type1" id="S33T26U264">temp</span> = <span class="mxinfo" id="T26:U212"><span class="fcn" id="F174N2:B266">GaussListND_mexCode</span>(<span class="mxinfo" id="T6:U213">(<span class="mxinfo" id="T19:U214"><span class="var type1" id="S23T7U270">minIndxY</span>:<span class="var type1" id="S24T7U271">maxIndxY</span></span>)'</span>,<span class="keyword">...</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,64"> 64</a></span><span class="line"><span class="mxinfo" id="T26:U210"><span class="mxinfo" id="T26:U212">        <span class="mxinfo" id="T7:U217"><span class="var type1" id="S18T3U273">psfSigma</span>(<span class="mxinfo" id="T7:U219">1</span>)</span>,<span class="mxinfo" id="T7:U220"><span class="var type1" id="S15T2U276">psfPos</span>(<span class="var type1" id="S32T5U277">i</span>,<span class="mxinfo" id="T7:U223">2</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,65"> 65</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,66"> 66</a></span><span class="line">    <span class="mxinfo" id="T4:U224"><span class="var type1" id="S35T4U281">temp2</span> = <span class="mxinfo" id="T4:U226">squeeze(<span class="var type1" id="S33T26U284">temp</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,67"> 67</a></span><span class="line">    <span class="comment">%clear temp</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,68"> 68</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,69"> 69</a></span><span class="line">    <span class="mxinfo" id="T6:U228"><span class="mxinfo" id="T6:U229"><span class="var type1" id="S37T4U288">psfIntegY</span>(<span class="mxinfo" id="T30:U231">:</span>,<span class="var type1" id="S32T5U290">i</span>)</span> = <span class="mxinfo" id="T6:U233"><span class="var type1" id="S35T4U292">temp2</span>(<span class="mxinfo" id="T30:U235">:</span>,<span class="mxinfo" id="T7:U236">1</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,70"> 70</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,71"> 71</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,72"> 72</a></span><span class="line"><span class="comment">%determine the contribution of each PSF (assuming amplitude 1) to a</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,73"> 73</a></span><span class="line"><span class="comment">%pixel based on its z-coordinate (needed to calculate F &amp; J)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,74"> 74</a></span><span class="line"><span class="mxinfo" id="T4:U237"><span class="var type1" id="S38T4U297">psfIntegZ</span> = <span class="mxinfo" id="T4:U239">zeros(<span class="mxinfo" id="T7:U240"><span class="mxinfo" id="T7:U241"><span class="var type1" id="S26T7U302">maxIndxZ</span>-<span class="var type1" id="S25T7U303">minIndxZ</span></span>+<span class="mxinfo" id="T7:U244">1</span></span>,<span class="var type1" id="S7T5U305">n</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,75"> 75</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S32T5U308">i</span>=<span class="mxinfo" id="T5:U247">1</span>:<span class="var type1" id="S7T5U311">n</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,76"> 76</a></span><span class="line">    <span class="mxinfo" id="T26:U249"><span class="var type1" id="S33T26U314">temp</span> = <span class="mxinfo" id="T26:U251"><span class="fcn" id="F174N2:B316">GaussListND_mexCode</span>(<span class="mxinfo" id="T6:U252">(<span class="mxinfo" id="T19:U253"><span class="var type1" id="S25T7U320">minIndxZ</span>:<span class="var type1" id="S26T7U321">maxIndxZ</span></span>)'</span>,<span class="keyword">...</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,77"> 77</a></span><span class="line"><span class="mxinfo" id="T26:U249"><span class="mxinfo" id="T26:U251">        <span class="mxinfo" id="T7:U256"><span class="var type1" id="S18T3U323">psfSigma</span>(<span class="mxinfo" id="T7:U258">2</span>)</span>,<span class="mxinfo" id="T7:U259"><span class="var type1" id="S15T2U326">psfPos</span>(<span class="var type1" id="S32T5U327">i</span>,<span class="mxinfo" id="T7:U262">3</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,78"> 78</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,79"> 79</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,80"> 80</a></span><span class="line">    <span class="mxinfo" id="T4:U263"><span class="var type1" id="S35T4U331">temp2</span> = <span class="mxinfo" id="T4:U265">squeeze(<span class="var type1" id="S33T26U334">temp</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,81"> 81</a></span><span class="line">    <span class="comment">%clear temp</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,82"> 82</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,83"> 83</a></span><span class="line">    <span class="mxinfo" id="T6:U267"><span class="mxinfo" id="T6:U268"><span class="var type1" id="S38T4U338">psfIntegZ</span>(<span class="mxinfo" id="T30:U270">:</span>,<span class="var type1" id="S32T5U340">i</span>)</span> = <span class="mxinfo" id="T6:U272"><span class="var type1" id="S35T4U342">temp2</span>(<span class="mxinfo" id="T30:U274">:</span>,<span class="mxinfo" id="T7:U275">1</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,84"> 84</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,85"> 85</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,86"> 86</a></span><span class="line"><span class="comment">%% PSF values for J</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,87"> 87</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo" id="T9:U276"><span class="var type1" id="S2T5U348">mode</span> &gt; <span class="mxinfo" id="T7:U278">0</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,88"> 88</a></span><span class="line">    <span class="comment">%calculate the value of each PSF (assuming amplitude 1) at the</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,89"> 89</a></span><span class="line">    <span class="comment">%x-coordinates of the corners of all pixels (needed to calculate J)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,90"> 90</a></span><span class="line">    <span class="mxinfo" id="T4:U279"><span class="var type1" id="S39T4U352">psfValueX</span> = <span class="mxinfo" id="T4:U281">zeros(<span class="mxinfo" id="T7:U282"><span class="mxinfo" id="T7:U283"><span class="var type1" id="S21T7U357">maxIndxX</span>-<span class="var type1" id="S19T7U358">minIndxX</span></span>+<span class="mxinfo" id="T7:U286">2</span></span>,<span class="var type1" id="S7T5U360">n</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,91"> 91</a></span><span class="line">    <span class="keyword">for</span> <span class="var type1" id="S32T5U363">i</span>=<span class="mxinfo" id="T5:U289">1</span>:<span class="var type1" id="S7T5U366">n</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,92"> 92</a></span><span class="line">        <span class="mxinfo" id="T6:U291"><span class="mxinfo" id="T6:U292"><span class="var type1" id="S39T4U370">psfValueX</span>(<span class="mxinfo" id="T30:U294">:</span>,<span class="var type1" id="S32T5U372">i</span>)</span> = <span class="mxinfo" id="T6:U296">exp(<span class="mxinfo" id="T6:U297"><span class="mxinfo" id="T6:U298"><span class="mxinfo" id="T6:U299">-<span class="mxinfo" id="T6:U300">(<span class="mxinfo" id="T6:U301"><span class="mxinfo" id="T6:U302">(<span class="mxinfo" id="T19:U303"><span class="mxinfo" id="T7:U304"><span class="var type1" id="S19T7U385">minIndxX</span>-<span class="mxinfo" id="T7:U306">0.5</span></span>:<span class="mxinfo" id="T7:U307"><span class="var type1" id="S21T7U388">maxIndxX</span>+<span class="mxinfo" id="T7:U309">0.5</span></span></span>)'</span><span class="keyword">...</span></span></span></span></span></span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,93"> 93</a></span><span class="line"><span class="mxinfo" id="T6:U291"><span class="mxinfo" id="T6:U296"><span class="mxinfo" id="T6:U297"><span class="mxinfo" id="T6:U298"><span class="mxinfo" id="T6:U299"><span class="mxinfo" id="T6:U300"><span class="mxinfo" id="T6:U301">            -<span class="mxinfo" id="T7:U310"><span class="var type1" id="S15T2U391">psfPos</span>(<span class="var type1" id="S32T5U392">i</span>,<span class="mxinfo" id="T7:U313">1</span>)</span></span>).^2</span></span>/<span class="mxinfo" id="T7:U314">2</span></span>/<span class="mxinfo" id="T7:U315"><span class="mxinfo" id="T7:U316"><span class="var type1" id="S18T3U398">psfSigma</span>(<span class="mxinfo" id="T7:U318">1</span>)</span>^2</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,94"> 94</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,95"> 95</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,96"> 96</a></span><span class="line">    <span class="comment">%calculate the value of each PSF (assuming amplitude 1) at the</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,97"> 97</a></span><span class="line">    <span class="comment">%y-coordinates of the corners of all pixels (needed to calculate J)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,98"> 98</a></span><span class="line">    <span class="mxinfo" id="T4:U319"><span class="var type1" id="S41T4U403">psfValueY</span> = <span class="mxinfo" id="T4:U321">zeros(<span class="mxinfo" id="T7:U322"><span class="mxinfo" id="T7:U323"><span class="var type1" id="S24T7U408">maxIndxY</span>-<span class="var type1" id="S23T7U409">minIndxY</span></span>+<span class="mxinfo" id="T7:U326">2</span></span>,<span class="var type1" id="S7T5U411">n</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,99"> 99</a></span><span class="line">    <span class="keyword">for</span> <span class="var type1" id="S32T5U414">i</span>=<span class="mxinfo" id="T5:U329">1</span>:<span class="var type1" id="S7T5U417">n</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,100">100</a></span><span class="line">        <span class="mxinfo" id="T6:U331"><span class="mxinfo" id="T6:U332"><span class="var type1" id="S41T4U421">psfValueY</span>(<span class="mxinfo" id="T30:U334">:</span>,<span class="var type1" id="S32T5U423">i</span>)</span> = <span class="mxinfo" id="T6:U336">exp(<span class="mxinfo" id="T6:U337"><span class="mxinfo" id="T6:U338"><span class="mxinfo" id="T6:U339">-<span class="mxinfo" id="T6:U340">(<span class="mxinfo" id="T6:U341"><span class="mxinfo" id="T6:U342">(<span class="mxinfo" id="T19:U343"><span class="mxinfo" id="T7:U344"><span class="var type1" id="S23T7U436">minIndxY</span>-<span class="mxinfo" id="T7:U346">0.5</span></span>:<span class="mxinfo" id="T7:U347"><span class="var type1" id="S24T7U439">maxIndxY</span>+<span class="mxinfo" id="T7:U349">0.5</span></span></span>)'</span><span class="keyword">...</span></span></span></span></span></span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,101">101</a></span><span class="line"><span class="mxinfo" id="T6:U331"><span class="mxinfo" id="T6:U336"><span class="mxinfo" id="T6:U337"><span class="mxinfo" id="T6:U338"><span class="mxinfo" id="T6:U339"><span class="mxinfo" id="T6:U340"><span class="mxinfo" id="T6:U341">            -<span class="mxinfo" id="T7:U350"><span class="var type1" id="S15T2U442">psfPos</span>(<span class="var type1" id="S32T5U443">i</span>,<span class="mxinfo" id="T7:U353">2</span>)</span></span>).^2</span></span>/<span class="mxinfo" id="T7:U354">2</span></span>/<span class="mxinfo" id="T7:U355"><span class="mxinfo" id="T7:U356"><span class="var type1" id="S18T3U449">psfSigma</span>(<span class="mxinfo" id="T7:U358">1</span>)</span>^2</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,102">102</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,103">103</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,104">104</a></span><span class="line">    <span class="comment">%calculate the value of each PSF (assuming amplitude 1) at the</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,105">105</a></span><span class="line">    <span class="comment">%z-coordinates of the corners of all pixels (needed to calculate J)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,106">106</a></span><span class="line">    <span class="mxinfo" id="T4:U359"><span class="var type1" id="S42T4U454">psfValueZ</span> = <span class="mxinfo" id="T4:U361">zeros(<span class="mxinfo" id="T7:U362"><span class="mxinfo" id="T7:U363"><span class="var type1" id="S26T7U459">maxIndxZ</span>-<span class="var type1" id="S25T7U460">minIndxZ</span></span>+<span class="mxinfo" id="T7:U366">2</span></span>,<span class="var type1" id="S7T5U462">n</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,107">107</a></span><span class="line">    <span class="keyword">for</span> <span class="var type1" id="S32T5U465">i</span>=<span class="mxinfo" id="T5:U369">1</span>:<span class="var type1" id="S7T5U468">n</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,108">108</a></span><span class="line">        <span class="mxinfo" id="T6:U371"><span class="mxinfo" id="T6:U372"><span class="var type1" id="S42T4U472">psfValueZ</span>(<span class="mxinfo" id="T30:U374">:</span>,<span class="var type1" id="S32T5U474">i</span>)</span> = <span class="mxinfo" id="T6:U376">exp(<span class="mxinfo" id="T6:U377"><span class="mxinfo" id="T6:U378"><span class="mxinfo" id="T6:U379">-<span class="mxinfo" id="T6:U380">(<span class="mxinfo" id="T6:U381"><span class="mxinfo" id="T6:U382">(<span class="mxinfo" id="T19:U383"><span class="mxinfo" id="T7:U384"><span class="var type1" id="S25T7U487">minIndxZ</span>-<span class="mxinfo" id="T7:U386">0.5</span></span>:<span class="mxinfo" id="T7:U387"><span class="var type1" id="S26T7U490">maxIndxZ</span>+<span class="mxinfo" id="T7:U389">0.5</span></span></span>)'</span><span class="keyword">...</span></span></span></span></span></span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,109">109</a></span><span class="line"><span class="mxinfo" id="T6:U371"><span class="mxinfo" id="T6:U376"><span class="mxinfo" id="T6:U377"><span class="mxinfo" id="T6:U378"><span class="mxinfo" id="T6:U379"><span class="mxinfo" id="T6:U380"><span class="mxinfo" id="T6:U381">            -<span class="mxinfo" id="T7:U390"><span class="var type1" id="S15T2U493">psfPos</span>(<span class="var type1" id="S32T5U494">i</span>,<span class="mxinfo" id="T7:U393">3</span>)</span></span>).^2</span></span>/<span class="mxinfo" id="T7:U394">2</span></span>/<span class="mxinfo" id="T7:U395"><span class="mxinfo" id="T7:U396"><span class="var type1" id="S18T3U500">psfSigma</span>(<span class="mxinfo" id="T7:U398">2</span>)</span>^2</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,110">110</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,111">111</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,112">112</a></span><span class="line">    <span class="comment">%% j calculation</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,113">113</a></span><span class="line">    <span class="mxinfo" id="T4:U399"><span class="var type1" id="S4T4U505">fjac</span> = <span class="mxinfo" id="T4:U401">ones(<span class="var type1" id="S6T5U508">m</span>,<span class="mxinfo" id="T5:U403"><span class="mxinfo" id="T5:U404">4*<span class="var type1" id="S7T5U512">n</span></span>+<span class="mxinfo" id="T5:U406">1</span></span>)</span></span>; <span class="comment">%(last column for background amplitude)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,114">114</a></span><span class="line">    <span class="mxinfo" id="T4:U407"><span class="mxinfo" id="T4:U408"><span class="var type1" id="S4T4U517">fjac</span>(<span class="mxinfo" id="T30:U410">:</span>,<span class="mxinfo" id="T30:U411"><span class="mxinfo" id="T5:U412">1</span>:<span class="mxinfo" id="T5:U413">4</span>:<span class="mxinfo" id="T5:U414">4*<span class="var type1" id="S7T5U525">n</span></span></span>)</span> = <span class="mxinfo" id="T4:U416"><span class="mxinfo" id="T4:U417"><span class="mxinfo" id="T4:U418"><span class="mxinfo" id="T4:U419">repmat(<span class="mxinfo" id="T19:U420"><span class="var type1" id="S16T6U532">psfAmp</span>'</span>,<span class="var type1" id="S6T5U533">m</span>,1)</span>.*(<span class="mxinfo" id="T4:U423"><span class="mxinfo" id="T4:U424"><span class="var type1" id="S39T4U538">psfValueX</span>(<span class="var type1" id="S27T6U539">relIndxX</span>,<span class="mxinfo" id="T30:U427">:</span>)</span>-<span class="keyword">...</span></span></span></span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,115">115</a></span><span class="line"><span class="mxinfo" id="T4:U407"><span class="mxinfo" id="T4:U416"><span class="mxinfo" id="T4:U417"><span class="mxinfo" id="T4:U418"><span class="mxinfo" id="T4:U423">        <span class="mxinfo" id="T4:U428"><span class="var type1" id="S39T4U542">psfValueX</span>(<span class="mxinfo" id="T30:U430"><span class="var type1" id="S27T6U544">relIndxX</span>+<span class="mxinfo" id="T7:U432">1</span></span>,<span class="mxinfo" id="T30:U433">:</span>)</span></span>)</span>.*<span class="mxinfo" id="T4:U434"><span class="var type1" id="S37T4U548">psfIntegY</span>(<span class="var type1" id="S28T6U549">relIndxY</span>,<span class="mxinfo" id="T30:U437">:</span>)</span></span>.*<span class="mxinfo" id="T4:U438"><span class="var type1" id="S38T4U552">psfIntegZ</span>(<span class="var type1" id="S29T6U553">relIndxZ</span>,<span class="mxinfo" id="T30:U441">:</span>)</span></span></span>; <span class="comment">%w.r.t. x</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,116">116</a></span><span class="line">    <span class="mxinfo" id="T4:U442"><span class="mxinfo" id="T4:U443"><span class="var type1" id="S4T4U558">fjac</span>(<span class="mxinfo" id="T30:U445">:</span>,<span class="mxinfo" id="T30:U446"><span class="mxinfo" id="T5:U447">2</span>:<span class="mxinfo" id="T5:U448">4</span>:<span class="mxinfo" id="T5:U449">4*<span class="var type1" id="S7T5U566">n</span></span></span>)</span> = <span class="mxinfo" id="T4:U451"><span class="mxinfo" id="T4:U452"><span class="mxinfo" id="T4:U453"><span class="mxinfo" id="T4:U454">repmat(<span class="mxinfo" id="T19:U455"><span class="var type1" id="S16T6U573">psfAmp</span>'</span>,<span class="var type1" id="S6T5U574">m</span>,1)</span>.*(<span class="mxinfo" id="T4:U458"><span class="mxinfo" id="T4:U459"><span class="var type1" id="S41T4U579">psfValueY</span>(<span class="var type1" id="S28T6U580">relIndxY</span>,<span class="mxinfo" id="T30:U462">:</span>)</span>-<span class="keyword">...</span></span></span></span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,117">117</a></span><span class="line"><span class="mxinfo" id="T4:U442"><span class="mxinfo" id="T4:U451"><span class="mxinfo" id="T4:U452"><span class="mxinfo" id="T4:U453"><span class="mxinfo" id="T4:U458">        <span class="mxinfo" id="T4:U463"><span class="var type1" id="S41T4U583">psfValueY</span>(<span class="mxinfo" id="T30:U465"><span class="var type1" id="S28T6U585">relIndxY</span>+<span class="mxinfo" id="T7:U467">1</span></span>,<span class="mxinfo" id="T30:U468">:</span>)</span></span>)</span>.*<span class="mxinfo" id="T4:U469"><span class="var type1" id="S30T4U589">psfIntegX</span>(<span class="var type1" id="S27T6U590">relIndxX</span>,<span class="mxinfo" id="T30:U472">:</span>)</span></span>.*<span class="mxinfo" id="T4:U473"><span class="var type1" id="S38T4U593">psfIntegZ</span>(<span class="var type1" id="S29T6U594">relIndxZ</span>,<span class="mxinfo" id="T30:U476">:</span>)</span></span></span>; <span class="comment">%w.r.t. y</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,118">118</a></span><span class="line">    <span class="mxinfo" id="T4:U477"><span class="mxinfo" id="T4:U478"><span class="var type1" id="S4T4U599">fjac</span>(<span class="mxinfo" id="T30:U480">:</span>,<span class="mxinfo" id="T30:U481"><span class="mxinfo" id="T5:U482">3</span>:<span class="mxinfo" id="T5:U483">4</span>:<span class="mxinfo" id="T5:U484">4*<span class="var type1" id="S7T5U607">n</span></span></span>)</span> = <span class="mxinfo" id="T4:U486"><span class="mxinfo" id="T4:U487"><span class="mxinfo" id="T4:U488"><span class="mxinfo" id="T4:U489">repmat(<span class="mxinfo" id="T19:U490"><span class="var type1" id="S16T6U614">psfAmp</span>'</span>,<span class="var type1" id="S6T5U615">m</span>,1)</span>.*(<span class="mxinfo" id="T4:U493"><span class="mxinfo" id="T4:U494"><span class="var type1" id="S42T4U620">psfValueZ</span>(<span class="var type1" id="S29T6U621">relIndxZ</span>,<span class="mxinfo" id="T30:U497">:</span>)</span>-<span class="keyword">...</span></span></span></span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,119">119</a></span><span class="line"><span class="mxinfo" id="T4:U477"><span class="mxinfo" id="T4:U486"><span class="mxinfo" id="T4:U487"><span class="mxinfo" id="T4:U488"><span class="mxinfo" id="T4:U493">        <span class="mxinfo" id="T4:U498"><span class="var type1" id="S42T4U624">psfValueZ</span>(<span class="mxinfo" id="T30:U500"><span class="var type1" id="S29T6U626">relIndxZ</span>+<span class="mxinfo" id="T7:U502">1</span></span>,<span class="mxinfo" id="T30:U503">:</span>)</span></span>)</span>.*<span class="mxinfo" id="T4:U504"><span class="var type1" id="S30T4U630">psfIntegX</span>(<span class="var type1" id="S27T6U631">relIndxX</span>,<span class="mxinfo" id="T30:U507">:</span>)</span></span>.*<span class="mxinfo" id="T4:U508"><span class="var type1" id="S37T4U634">psfIntegY</span>(<span class="var type1" id="S28T6U635">relIndxY</span>,<span class="mxinfo" id="T30:U511">:</span>)</span></span></span>; <span class="comment">%w.r.t. z</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,120">120</a></span><span class="line">    <span class="mxinfo" id="T4:U512"><span class="mxinfo" id="T4:U513"><span class="var type1" id="S4T4U640">fjac</span>(<span class="mxinfo" id="T30:U515">:</span>,<span class="mxinfo" id="T30:U516"><span class="mxinfo" id="T5:U517">4</span>:<span class="mxinfo" id="T5:U518">4</span>:<span class="mxinfo" id="T5:U519">4*<span class="var type1" id="S7T5U648">n</span></span></span>)</span> = <span class="mxinfo" id="T4:U521"><span class="mxinfo" id="T4:U522"><span class="mxinfo" id="T4:U523"><span class="var type1" id="S30T4U652">psfIntegX</span>(<span class="var type1" id="S27T6U653">relIndxX</span>,<span class="mxinfo" id="T30:U526">:</span>)</span>.*<span class="mxinfo" id="T4:U527"><span class="var type1" id="S37T4U656">psfIntegY</span>(<span class="var type1" id="S28T6U657">relIndxY</span>,<span class="mxinfo" id="T30:U530">:</span>)</span></span>.*<span class="mxinfo" id="T4:U531"><span class="var type1" id="S38T4U660">psfIntegZ</span>(<span class="var type1" id="S29T6U661">relIndxZ</span>,<span class="mxinfo" id="T30:U534">:</span>)</span></span></span>; <span class="comment">%w.r.t. amp</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,121">121</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,122">122</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,123">123</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,124">124</a></span><span class="line"><span class="comment">%% f calulation</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,125">125</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo" id="T9:U535"><span class="var type1" id="S2T5U666">mode</span> ~= <span class="mxinfo" id="T7:U537">1</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,126">126</a></span><span class="line">    <span class="keyword">if</span> <span class="mxinfo" id="T9:U538"><span class="var type1" id="S9T5U671">needfi</span> &gt; <span class="mxinfo" id="T7:U540">0</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,127">127</a></span><span class="line">        <span class="mxinfo" id="T4:U541"><span class="var type1" id="S3T4U675">f</span> = <span class="mxinfo" id="T6:U543">zeros(<span class="var type1" id="S6T5U678">m</span>,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,128">128</a></span><span class="line">        <span class="mxinfo" id="T7:U545"><span class="mxinfo" id="T7:U546"><span class="var type1" id="S3T4U683">f</span>(<span class="var type1" id="S9T5U684">needfi</span>)</span> = <span class="mxinfo" id="T6:U549"><span class="mxinfo" id="T6:U550">(<span class="mxinfo" id="T19:U551">sum(<span class="mxinfo" id="T4:U552"><span class="mxinfo" id="T4:U553"><span class="mxinfo" id="T4:U554"><span class="mxinfo" id="T4:U555">repmat(<span class="var type1" id="S16T6U695">psfAmp</span>,1,<span class="var type1" id="S6T5U697">m</span>)</span>.*<span class="mxinfo" id="T4:U558"><span class="mxinfo" id="T4:U559"><span class="var type1" id="S30T4U700">psfIntegX</span>(<span class="var type1" id="S27T6U701">relIndxX</span>,<span class="mxinfo" id="T30:U562">:</span>)</span>'</span></span>.*<span class="mxinfo" id="T4:U563"><span class="mxinfo" id="T4:U564"><span class="var type1" id="S37T4U705">psfIntegY</span>(<span class="var type1" id="S28T6U706">relIndxY</span>,<span class="mxinfo" id="T30:U567">:</span>)</span>'</span></span>.*<span class="mxinfo" id="T4:U568"><span class="mxinfo" id="T4:U569"><span class="var type1" id="S38T4U710">psfIntegZ</span>(<span class="var type1" id="S29T6U711">relIndxZ</span>,<span class="mxinfo" id="T30:U572">:</span>)</span>'</span></span>,1)</span>)'</span> + <span class="mxinfo" id="T6:U573">repmat(<span class="var type1" id="S12T7U716">bgAmp</span>,<span class="var type1" id="S6T5U717">m</span>,1)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,129">129</a></span><span class="line">    <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,130">130</a></span><span class="line">        <span class="mxinfo" id="T4:U576"><span class="var type1" id="S3T4U722">f</span> = <span class="mxinfo" id="T6:U578"><span class="mxinfo" id="T6:U579">(<span class="mxinfo" id="T19:U580">sum(<span class="mxinfo" id="T4:U581"><span class="mxinfo" id="T4:U582"><span class="mxinfo" id="T4:U583"><span class="mxinfo" id="T4:U584">repmat(<span class="var type1" id="S16T6U733">psfAmp</span>,1,<span class="var type1" id="S6T5U735">m</span>)</span>.*<span class="mxinfo" id="T4:U587"><span class="mxinfo" id="T4:U588"><span class="var type1" id="S30T4U738">psfIntegX</span>(<span class="var type1" id="S27T6U739">relIndxX</span>,<span class="mxinfo" id="T30:U591">:</span>)</span>'</span></span>.*<span class="mxinfo" id="T4:U592"><span class="mxinfo" id="T4:U593"><span class="var type1" id="S37T4U743">psfIntegY</span>(<span class="var type1" id="S28T6U744">relIndxY</span>,<span class="mxinfo" id="T30:U596">:</span>)</span>'</span></span>.*<span class="mxinfo" id="T4:U597"><span class="mxinfo" id="T4:U598"><span class="var type1" id="S38T4U748">psfIntegZ</span>(<span class="var type1" id="S29T6U749">relIndxZ</span>,<span class="mxinfo" id="T30:U601">:</span>)</span>'</span></span>,1)</span>)'</span> + <span class="mxinfo" id="T6:U602">repmat(<span class="var type1" id="S12T7U754">bgAmp</span>,<span class="var type1" id="S6T5U755">m</span>,1)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,131">131</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,132">132</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,133">133</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,134">134</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,135">135</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,136">136</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,137">137</a></span><span class="line"></span></span>
</pre>
